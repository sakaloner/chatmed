import{r as ee,s as G,n as N,o as se}from"../chunks/scheduler.e108d1fd.js";import{t as U,d as V,S as O,i as q,g as $,m as J,h as T,j as I,n as Q,f as d,k as C,a as b,x as A,o as ne,s as j,c as z,y as te,z as W,A as H,B as ae,p as le,b as oe,e as X,r as R,u as x,v as F,w as L}from"../chunks/index.c6da1de8.js";function Y(l){return(l==null?void 0:l.length)!==void 0?l:Array.from(l)}function ie(l,e){U(l,1,1,()=>{e.delete(l.key)})}function re(l,e,t,s,a,n,i,u,f,h,w,k){let g=l.length,v=n.length,y=g;const E={};for(;y--;)E[l[y].key]=y;const D=[],M=new Map,p=new Map,S=[];for(y=v;y--;){const c=k(a,n,y),_=t(c);let m=i.get(_);m?s&&S.push(()=>m.p(c,e)):(m=h(_,c),m.c()),M.set(_,D[y]=m),_ in E&&p.set(_,Math.abs(y-E[_]))}const B=new Set,o=new Set;function r(c){V(c,1),c.m(u,w),i.set(c.key,c),w=c.first,v--}for(;g&&v;){const c=D[v-1],_=l[g-1],m=c.key,P=_.key;c===_?(w=c.first,g--,v--):M.has(P)?!i.has(m)||B.has(m)?r(c):o.has(P)?g--:p.get(m)>p.get(P)?(o.add(m),r(c)):(B.add(P),g--):(f(_,i),g--)}for(;g--;){const c=l[g];M.has(c.key)||f(c,i)}for(;v;)r(D[v-1]);return ee(S),D}function ce(l){let e,t,s=l[0].content+"",a,n;return{c(){e=$("div"),t=$("p"),a=J(s),this.h()},l(i){e=T(i,"DIV",{class:!0});var u=I(e);t=T(u,"P",{});var f=I(t);a=Q(f,s),f.forEach(d),u.forEach(d),this.h()},h(){C(e,"class",n="message "+l[0].role+" svelte-1d0jllh")},m(i,u){b(i,e,u),A(e,t),A(t,a)},p(i,[u]){u&1&&s!==(s=i[0].content+"")&&ne(a,s),u&1&&n!==(n="message "+i[0].role+" svelte-1d0jllh")&&C(e,"class",n)},i:N,o:N,d(i){i&&d(e)}}}function ue(l,e,t){let{message:s}=e;return l.$$set=a=>{"message"in a&&t(0,s=a.message)},[s]}class fe extends O{constructor(e){super(),q(this,e,ue,ce,G,{message:0})}}async function de(l,e){let s={model:e?"gpt-4":"gpt-3.5-turbo",messages:[{role:"system",content:`
Soy médico general. Me ayudarás a diagnosticar y tratar a los pacientes que acuden a mi consulta. Por favor
dame varias opciones sobre las posibles causas de la enfermedad del paciente y los tratamientos.
Se conciso y por favor no escribas cosas como esta al final pues me hace perder tiempo valioso que podria
usar ayudando a mis pacientes:
"Se recomienda consultar a un médico especialista en osteoporosis para una evaluación detallada y un plan de tratamiento personalizado."
o "Recuerda que estos son posibles diagnósticos, pero siempre se debe realizar una evaluación clínica completa."`}]};return s.messages.push(...l),console.log("history",l),console.log("new_data",s),(await(await fetch("https://api.openai.com/v1/chat/completions",{body:JSON.stringify(s),headers:{Authorization:"Bearer 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","Content-Type":"application/json"},method:"POST"})).json()).choices[0].message}function Z(l,e,t){const s=l.slice();return s[6]=e[t],s[8]=t,s}function me(l){let e;return{c(){e=J("Activate GPT-4")},l(t){e=Q(t,"Activate GPT-4")},m(t,s){b(t,e,s)},d(t){t&&d(e)}}}function he(l){let e;return{c(){e=J("Deactivate GPT-4")},l(t){e=Q(t,"Deactivate GPT-4")},m(t,s){b(t,e,s)},d(t){t&&d(e)}}}function K(l,e){let t,s,a;return s=new fe({props:{message:e[6]}}),{key:l,first:null,c(){t=X(),R(s.$$.fragment),this.h()},l(n){t=X(),x(s.$$.fragment,n),this.h()},h(){this.first=t},m(n,i){b(n,t,i),F(s,n,i),a=!0},p(n,i){e=n;const u={};i&2&&(u.message=e[6]),s.$set(u)},i(n){a||(V(s.$$.fragment,n),a=!0)},o(n){U(s.$$.fragment,n),a=!1},d(n){n&&d(t),L(s,n)}}}function pe(l){let e,t,s,a,n=[],i=new Map,u,f,h,w,k,g="Send",v,y,E;function D(o,r){return o[2]?he:me}let M=D(l),p=M(l),S=Y(l[1]);const B=o=>o[8];for(let o=0;o<S.length;o+=1){let r=Z(l,S,o),c=B(r);i.set(c,n[o]=K(c,r))}return{c(){e=$("div"),t=$("button"),p.c(),s=j(),a=$("div");for(let o=0;o<n.length;o+=1)n[o].c();u=j(),f=$("form"),h=$("input"),w=j(),k=$("button"),k.textContent=g,this.h()},l(o){e=T(o,"DIV",{});var r=I(e);t=T(r,"BUTTON",{});var c=I(t);p.l(c),c.forEach(d),r.forEach(d),s=z(o),a=T(o,"DIV",{class:!0});var _=I(a);for(let P=0;P<n.length;P+=1)n[P].l(_);_.forEach(d),u=z(o),f=T(o,"FORM",{class:!0});var m=I(f);h=T(m,"INPUT",{placeholder:!0,class:!0}),w=z(m),k=T(m,"BUTTON",{type:!0,"data-svelte-h":!0}),te(k)!=="svelte-ah9bu5"&&(k.textContent=g),m.forEach(d),this.h()},h(){C(a,"class","chat-window svelte-184ywgd"),C(h,"placeholder","Type your message here..."),C(h,"class","svelte-184ywgd"),C(k,"type","submit"),C(f,"class","svelte-184ywgd")},m(o,r){b(o,e,r),A(e,t),p.m(t,null),b(o,s,r),b(o,a,r);for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(a,null);b(o,u,r),b(o,f,r),A(f,h),W(h,l[0]),A(f,w),A(f,k),v=!0,y||(E=[H(t,"click",l[3]),H(h,"input",l[5]),H(f,"submit",ae(l[4]))],y=!0)},p(o,[r]){M!==(M=D(o))&&(p.d(1),p=M(o),p&&(p.c(),p.m(t,null))),r&2&&(S=Y(o[1]),le(),n=re(n,r,B,1,o,S,i,a,ie,K,null,Z),oe()),r&1&&h.value!==o[0]&&W(h,o[0])},i(o){if(!v){for(let r=0;r<S.length;r+=1)V(n[r]);v=!0}},o(o){for(let r=0;r<n.length;r+=1)U(n[r]);v=!1},d(o){o&&(d(e),d(s),d(a),d(u),d(f)),p.d();for(let r=0;r<n.length;r+=1)n[r].d();y=!1,ee(E)}}}function _e(l,e,t){let s="",a=[{role:"assistant",content:"Hola, como puedo ayudarte hoy?"}],n=!1;function i(){t(2,n=!n)}async function u(){t(1,a=[...a,{role:"user",content:s}]),t(0,s=""),t(1,a=[...a,{role:"assistant",content:"..."}]);let h=a.slice(0,a.length-1);console.log("messages to send",h);let w=await de(h,n);a.pop(),console.log("res",w,w.content),t(1,a=[...a,{role:"assistant",content:w.content}])}function f(){s=this.value,t(0,s)}return[s,a,n,i,u,f]}class ge extends O{constructor(e){super(),q(this,e,_e,pe,G,{})}}function ve(l){let e,t="<h1>ChatMed</h1>";return{c(){e=$("div"),e.innerHTML=t},l(s){e=T(s,"DIV",{"data-svelte-h":!0}),te(e)!=="svelte-6m3hyn"&&(e.innerHTML=t)},m(s,a){b(s,e,a)},p:N,i:N,o:N,d(s){s&&d(e)}}}function ye(l){let e;return se(()=>{e=localStorage.getItem("currentTabUrl"),console.log("currentTabUrl",e)}),[]}class we extends O{constructor(e){super(),q(this,e,ye,ve,G,{})}}function be(l){let e,t,s,a,n;return t=new we({}),a=new ge({}),{c(){e=$("div"),R(t.$$.fragment),s=j(),R(a.$$.fragment),this.h()},l(i){e=T(i,"DIV",{id:!0});var u=I(e);x(t.$$.fragment,u),s=z(u),x(a.$$.fragment,u),u.forEach(d),this.h()},h(){C(e,"id","main-div")},m(i,u){b(i,e,u),F(t,e,null),A(e,s),F(a,e,null),n=!0},p:N,i(i){n||(V(t.$$.fragment,i),V(a.$$.fragment,i),n=!0)},o(i){U(t.$$.fragment,i),U(a.$$.fragment,i),n=!1},d(i){i&&d(e),L(t),L(a)}}}class ke extends O{constructor(e){super(),q(this,e,null,be,G,{})}}export{ke as component};
